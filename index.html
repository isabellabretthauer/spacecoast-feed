<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <meta http-equiv="refresh" content="3600"/>
  <title>Upcoming Launches &amp; Events</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-blue-900 text-white p-4 flex flex-col md:flex-row items-center justify-center gap-4">
    <img src="https://www.visitspacecoast.com/wp-content/themes/visitspacecoast-com/resources/images/logo.png"
         alt="Visit Space Coast Logo" class="w-56 h-auto">
    <h1 class="text-2xl font-bold">Upcoming Launches &amp; Events</h1>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <section class="mb-12">
      <h2 class="text-2xl font-bold border-b-2 border-blue-800 pb-2 mb-6">Upcoming Launches</h2>
      <div id="launches" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section class="mb-12 bg-white rounded-lg shadow-md overflow-hidden">
      <h2 class="text-xl font-bold bg-blue-800 text-white p-4">Launch Viewing Locations</h2>
      <div class="p-4">
        <img src="https://www.visitspacecoast.com/wp-content/uploads/2023/12/Launch-Viewing-Map.png"
             alt="Launch Viewing Map" class="w-full h-auto rounded-lg">
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold border-b-2 border-blue-800 pb-2 mb-6">Upcoming Events</h2>
      <div id="events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <footer class="bg-gray-800 text-white p-6 text-center">
    <div class="flex flex-col items-center">
      <img src="https://www.visitspacecoast.com/wp-content/uploads/2025/06/CRS21-wide-scaled.jpg"
           alt="Space Coast Banner" class="w-full max-w-4xl rounded-lg mb-4">
      <div class="bg-gray-700 p-4 rounded-lg inline-block">
        <p class="text-xl font-semibold mb-2">Download the Official App</p>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fspace-coast-launches%2Fid123456789"
             alt="QR for App" class="mx-auto">
      </div>
      <p class="mt-4">Data provided by <a href="https://www.visitspacecoast.com" class="text-blue-300 hover:text-blue-100">Visit Space Coast</a></p>
    </div>
  </footer>

  <script>
    async function loadFeed() {
      const resp = await fetch('spacecoast_feed.xml');
      const xml  = new DOMParser().parseFromString(await resp.text(),'application/xml');
      const items = [...xml.querySelectorAll('item')];
      const L = document.getElementById('launches');
      const E = document.getElementById('events');

      items.forEach(i => {
        const fullTitle = i.querySelector('title').textContent;
        const title     = fullTitle.replace(/^(Launch|Event):\s*/,'');
        const link      = i.querySelector('link').textContent;
        const desc      = i.querySelector('description').textContent.trim();
        const dtText    = i.querySelector('pubDate')?.textContent;
        const enc       = i.querySelector('enclosure');
        const imgUrl    = enc?.getAttribute('url') || 'https://placehold.co/600x400?text=No+Image';
        const isLaunch  = fullTitle.startsWith('Launch:');

        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-md overflow-hidden flex flex-col';

        // image
        const img = document.createElement('img');
        img.src = imgUrl;
        img.alt = title;
        img.className = 'w-full h-48 object-cover';
        img.onerror = ()=>{ img.src = 'https://placehold.co/600x400?text=No+Image'; };
        card.appendChild(img);

        // content
        const c = document.createElement('div');
        c.className = 'p-4 flex-grow flex flex-col';

        const h3 = document.createElement('h3');
        h3.className = 'text-xl font-semibold mb-2';
        h3.innerHTML = `<a href="${link}" target="_blank" class="text-blue-700 hover:text-blue-900">${title}</a>`;
        c.appendChild(h3);

        // summary
        const p = document.createElement('p');
        p.className = 'text-gray-700 mb-4';
        p.textContent = desc;
        c.appendChild(p);

        // date/time
        if (dtText) {
          const d = document.createElement('p');
          d.className = 'text-sm text-gray-500 mt-auto';
          const dt = new Date(dtText);
          d.textContent = dt.toLocaleString('en-US', {
            weekday: 'short', month: 'short', day: 'numeric',
            hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York'
          });
          c.appendChild(d);
        }

        // event QR
        if (!isLaunch) {
          const qr = document.createElement('img');
          qr.className = 'w-32 h-32 mx-auto mt-4';
          qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(link)}`;
          qr.alt = `Scan to open ${title}`;
          c.appendChild(qr);
        }

        card.appendChild(c);
        ;(isLaunch? L : E).appendChild(card);
      });

      // more launches QR
      const more = document.createElement('div');
      more.className = 'bg-white rounded-lg shadow-md overflow-hidden flex flex-col';
      more.innerHTML = `
        <div class="p-6 text-center flex-grow flex flex-col justify-center">
          <h3 class="text-xl font-semibold mb-2">More Launches</h3>
          <p class="text-gray-600 mb-4">Scan for complete schedule</p>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(BASE+'/launches/')}"
               alt="More launches QR" class="w-32 h-32 mx-auto">
        </div>`;
      L.appendChild(more);
    }

    document.addEventListener('DOMContentLoaded', loadFeed);
  </script>
</body>
</html>
